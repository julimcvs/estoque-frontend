<template>
  <v-container>
    <p class="titulo text-center py-5 text-primary">
      Página de Confirmação - Movimentação de Estoque
    </p>
    <v-divider class="d-block my-5"/>
    <v-container class="py-5">
      <div class="campos-confirmacao text-wrap">
        <p>
          <strong>Tipo de Movimentação:</strong>
          {{ form.tipoMovimentacao.title }}
        </p>
        <TabelaProdutosMovimentacao
          :editable="false"
          class="mt-5"/>
      </div>
    </v-container>
    <v-container class="pb-0 d-flex justify-space-between">
      <v-btn
        class="ml-5"
        color="primary"
        prepend-icon="mdi-chevron-left"
        size="x-large"
        variant="outlined"
        @click="prev"
      >
        Voltar
      </v-btn>
      <v-btn
        :loading="loading"
        append-icon="mdi-check-circle"
        class="ml-5"
        color="success"
        size="x-large"
        type="submit"
        variant="elevated"
        @click="confirmar"
      >
        Confirmar
      </v-btn>
    </v-container>
  </v-container>
</template>
<script>
import {mapActions, mapState, mapWritableState} from "pinia";
import {useMovimentacaoEstoqueStore} from "@/stores/movimentacao-estoque";
import {useAlertStore} from "@/stores/alert";
import TabelaProdutosMovimentacao from "@/components/movimentacoes-estoque/tabela-produtos.vue";

export default {
  name: 'ConfirmacaoMovimentacao',
  components: {TabelaProdutosMovimentacao},

  computed: {
    ...mapState(useMovimentacaoEstoqueStore, ['form']),
    ...mapWritableState(useMovimentacaoEstoqueStore, ['currentStep']),
  },

  data: () => ({
    loading: false,
  }),

  methods: {
    ...mapActions(useAlertStore, ['showSuccess', 'showError']),
    ...mapActions(useMovimentacaoEstoqueStore, ['limparFormulario', 'movimentarEstoque']),

    async confirmar() {
      this.loading = true;
      try {
        await this.movimentarEstoque(this.form);
        this.showSuccess('Movimentação de estoque realizada com sucesso!');
        this.limparFormulario();
        this.$router.push('/home')
      } catch (e) {
        this.showError(`Erro ao movimentar estoque: ${e.response.data.message}`);
      } finally {
        this.loading = false;
      }
    },

    prev() {
      this.currentStep--;
    },
  }
}
</script>
<style scoped>
.campos-confirmacao {
  font-size: 22px;
}

.titulo {
  font-size: 30px;
}
</style>
